<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>login</title>
	<link rel="icon" href="../../images/artionLogo.png" type="image/png">
<!-- 	<link href="../../css/activity/singleActivity.css" rel="stylesheet" /> -->
<!-- 	<link href="../../css/activity/singleActivityCover.css" rel="stylesheet" /> -->
	<link
		href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
		rel="stylesheet">
	
	<link rel="stylesheet" href="../../css/member/member.css">
  
</head>
<body>
	<!-- 整個頁面容器開始 -->
	<div class="container-fluid p-0">
        <div class="loginstate"></div>
		<div class="container-fluid">
			<!--除了navbar 以外的東西放裡面 -->
<!-- ======================================================================================== -->
			<div id="activityDetails">
				<!-- 这里将显示活动详细信息 -->
			</div>
			<!-- Page content-->
			<div class="container mt-5">
				<div class="row">
					<div class="col-lg-8">
						<!-- Post content-->
						<article>
							<!-- Post header-->
							<!-- Preview image figure-->
							<figure class="mb-4">
								<div>
									<img src="" alt="" width="100%" height="100%" id="actCovPic">
								</div>
							</figure>

							<header class="mb-4">
								<!-- Post title-->
								<!-- Post categories-->
<!-- ========================================== 類型 ========================================== -->
								<a class="badge bg-secondary text-decoration-none link-light"
									href="#" id="actType"></a><br>
<!-- ========================================== 活動名稱與收藏 ========================================== -->
								<div class="header_container collectionbtn" style:"display: flex;">
									<span class="fw-bolder mb-1 activity_name" style="font-size: 40px;" id=actName></span>
									<button type="button" class="btn btn-outline-success">收藏</button>
								</div>
<!-- ========================================== 活動介紹與購物車 ========================================== -->
								<!-- Post meta content-->
								<!-- <div class="card bg-light"></div> -->
								<div class="text-muted fst-italic mb-2" id=actTime></div>
								<div class="text-muted fst-italic mb-2">
									<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
										viewBox="0 0 16 16">
                                        <path fill="currentColor"
											d="M9.156 14.544C10.899 13.01 14 9.876 14 7A6 6 0 0 0 2 7c0 2.876 3.1 6.01 4.844 7.544a1.736 1.736 0 0 0 2.312 0ZM6 7a2 2 0 1 1 4 0a2 2 0 0 1-4 0Z" />
                                    </svg>
									<span id="actAdd"></span>
								</div>
								<div class="text-muted fst-italic mb-2"
									style="display: inline-block; margin-right: 10px;">
									<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
										viewBox="0 0 100 100">
                                        <path fill="currentColor"
											d="M81.465 66.127c-.022-.038-.052-.069-.076-.105l.002-.001l-26.904-46.599l-.014.008a2.08 2.08 0 0 0-.929-.801l.038-.022l-11.01-6.357v.044a2.082 2.082 0 0 0-1.846-.107l-.012-.021l-.206.119c-.004.003-.009.003-.013.006c-.004.002-.007.006-.012.008L19.3 24.529a2.078 2.078 0 0 0-1.037 1.764l-.007-.004v12.714l.021-.012c-.047.427.03.872.261 1.273c.014.024.032.042.047.065l26.816 46.446c.026.055.044.112.075.166a2.085 2.085 0 0 0 2.772.801l.005.008l32.465-18.743l-.014-.025a2.092 2.092 0 0 0 .761-2.855zM36.366 29.361a3.865 3.865 0 1 1 1.415-5.279a3.864 3.864 0 0 1-1.415 5.279z" />
                                    </svg>
									<span id=actTicPrice></span> 元/人
								</div>
								<button type="button" class="btn btn-outline-danger"
									style="display: inline-block; margin-right: 10px;" id="buyTicket">立即購票</button>
								<button type="button" class="btn btn-outline-danger"
									id="addtocart">加入購物車</button>
								<!-- <a class="badge bg-secondary text-decoration-none link-light" href="#!">Freebies</a> -->
							</header>
							<!-- Post content-->
							<section class="mb-5">
								<p class="fs-5 mb-4">
								<hr>
								<div id=actContent></div>
								</p>
							</section>
						</article>
						<!-- 活動留言開始-->
						<section class="mb-5">
							<div class="card bg-light">
								<div class="card-body" id="messageArea">
									<div class="was-validated">
										<div class="mb-3">
											<div
												style="display: flex; justify-content: space-between; align-items: center;">
												<label for="validationTextarea" class="form-label"
													style="font-size: 25px">留言板</label>
												<div class="dropdown-center">
													<button class="btn btn-secondary dropdown-toggle"
														type="button" data-bs-toggle="dropdown"
														aria-expanded="false">排序方式</button>
													<ul class="dropdown-menu">
														<li><a class="dropdown-item" href="#">留言:由新至舊</a></li>
														<li><a class="dropdown-item" href="#">留言:由舊至新</a></li>
														<li><a class="dropdown-item" href="#">按讚:由多至少</a></li>
														<li><a class="dropdown-item" href="#">按讚:由少至多</a></li>
													</ul>
												</div>
											</div>
											<br>
											<!--留言送出 -->
											<form method="post"
												ACTION="http://localhost:8081/artion/addActComServlet"
												id="commentForm" enctype="multipart/form-data">
												<div class="comment-group">
													<input name="actComContent" id="actComContent" cols="30"
														rows="10" placeholder="在此輸入您的留言" class="actComContent">
													</textarea>
													<input type="hidden" id="actId" name="actId" value="">
													<!--                                                     <button type="submit" class="btn btn-outline-secondary" id="submit">送出</button> -->
													<input type="hidden" name="action" value="insert">
													<input type="submit" value="送出留言">
												</div>
												<div id="displayMessage"></div>
												<div class="mb-3">
													<div class="imageUpload_delete">
														<div class="row">
															<div class="col">
																<input name="actComCovPicture" id="actComCovPicture"
																	type="file" accept="image/*" style="display: none;">
																<button type="button" id="picture1"
																	style="margin: 3px 0px; padding: 5px; color: white; background-color: #6A9C89; border: 1px solid #6A9C89; border-radius: 5px; cursor: pointer;">上傳圖片1</button>
																<br> <span id="pictureText1">未選取圖片</span>
															</div>
															<div class="col">
																<input name="actComPicture1" id="actComPicture1"
																	type="file" accept="image/*" style="display: none;">
																<button type="button" id="picture2"
																	style="margin: 3px 0px; padding: 5px; color: white; background-color: #6A9C89; border: 1px solid #6A9C89; border-radius: 5px; cursor: pointer;">上傳圖片2</button>
																<br> <span id="pictureText2">未選取圖片</span>
															</div>
															<div class="col">
																<input name="actComPicture2" id="actComPicture2"
																	type="file" accept="image/*" style="display: none;">
																<button type="button" id="picture3"
																	style="margin: 3px 0px; padding: 5px; color: white; background-color: #6A9C89; border: 1px solid #6A9C89; border-radius: 5px; cursor: pointer;">上傳圖片3</button>
																<br> <span id="pictureText3">未選取圖片</span>
															</div>
															<div class="col">
																<input name="actComPicture3" id="actComPicture3"
																	type="file" accept="image/*" style="display: none;">
																<button type="button" id="picture4"
																	style="margin: 3px 0px; padding: 5px; color: white; background-color: #6A9C89; border: 1px solid #6A9C89; border-radius: 5px; cursor: pointer;">上傳圖片4</button>
																<br> <span id="pictureText4">未選取圖片</span>
															</div>
															<button type="button" class="btn btn-outline-secondary"
																style="margin-left: 10px; width: 100px; height: 50px;"
																id="clearFiles">清除檔案</button>
														</div>
													</div>
												</div>
											</form>
											<!-- <div id="imagePreviews"> -->
											<!-- 預覽圖 -->
											<!-- </div> -->
										</div>
									</div>
								</div>
								<!-- 留言送出start -->
								</span> <span id="imagePreviewsForMessage"></span>
								<!-- <hr> -->
								<!-- 留言送出end -->
							</div>
						</section>
						<!-- 活動留言結束-->
					</div>
					<!-- 廠商介紹start-->
					<div class="col-lg-4 ">
<!-- 						<div class="card mb-4 sel_introduce"> -->
<!-- 							<img src="" alt="" style="width: 120px;" id="selPhoto"> -->
<!-- 							<div class="card-header card_header_fontstyle" id="selName"> -->
<!-- 								名稱 -->
<!-- 							</div> -->
<!-- 							<div class="card-body"> -->
<!-- 								<p class="content-text" id="selInfo"> -->
<!-- 									廠商介紹 -->
<!-- 								</p> -->
<!-- 							</div> -->
<!-- 						</div> -->
						<!-- 廠商介紹end-->
						<!-- 活動地圖start -->
						<div class="card mb-4 act_map">
							<div class="card-header card_header_fontstyle">活動地圖</div>
							<div class="card-body">
								<div id="actMap">
									<!-- 活動google apie api -->
								</div>
							</div>
						</div>
						<!-- 活動地圖end -->
					</div>
				</div>
			</div>
<!-- ======================================================================================== -->
		</div>
	</div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
        crossorigin="anonymous"></script>
        <script src="https://kit.fontawesome.com/53f3396f69.js"
		crossorigin="anonymous"></script>
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="../../js/activity/logstate.js"></script>
        
<script>
//================== 獲取活動頁資料並渲染在畫面上(測試) ==================
$(document).ready(function () {
    var urlParams = new URLSearchParams(window.location.search);
    var actId = urlParams.get("actId");
    var actTypeMap = {
        1: '展覽',
        2: '市集',
        3: '表演'
    };
    if (actId) {
        $.ajax({
            type: "POST",
            url: "http://localhost:8081/artion/getAllAct",
            dataType: "JSON",
            success: function (data) {
                var actData = data.find(function (act) {
                    return act.actId == actId;
                });

                if (actData) {
                    var actTypeText = actTypeMap[actData.actType] || '未知類型';

                    $("#actType").text(actTypeText);
                    $("#actName").text(actData.actName);
                    $("#iconCount").text(actData.ActLikeTimes);
                    $("#actTime").text(actData.actStartDate + " ~ " + actData.actEndDate + " , " + actData.ActStartTime + " ~ " + actData.ActEndTime);
                    $("#actAdd").text(actData.ActAdd);
                    $("#actTicPrice").text(actData.actTicPrice);
                    $("#actContent").text(actData.ActContent);
                    var imgSrc = "http://localhost:8081/artion/actPicServlet?actId=" + actId;
	                $("#actCovPic").attr("src", imgSrc);
                    // 构建Google Maps URL
                    var mapUrl = "https://www.google.com/maps/embed/v1/place?key=YOUR_API_KEY&q=" + encodeURIComponent(actData.ActAdd) + "&zoom=10";

                    // 创建并插入iframe
                    var iframe = $('<iframe>').attr({
                        width: 200,
                        height: 200,
                        style: 'border: 0',
                        loading: 'lazy',
                        allowfullscreen: true,
                        referrerpolicy: 'no-referrer-when-downgrade',
                        src: mapUrl
                    });

                    $("#actMap").append(iframe);
                } else {
                    $("#actData").html("找不到該活動的數據");
                }
            },
            error: function () {
                alert("無法活動獲取數據");
            }
        });
    } else {
        $("#actData").html("未提供活動ID");
    }
});



//================== 取得localstorage + 活動收藏 ==================
        function getActIdFromURL() {
            var urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('actId');
        }
        let path = window.location.pathname;
        path = path.substring(0, path.indexOf("/", 1));
        $(document).ready(function () {
            $(".collectionbtn").click(function () {
                var memId = localStorage.getItem('memId');
                if (memId) {
                    var actId = getActIdFromURL();
                    var status = 1; 
                    
                    var data = {
                    	action:"insert",
                        memId: memId,
                        actId: actId,
                    };
                    $.ajax({
                        type: "POST",
                        url: `${window.location, path}/CollectionServlet`, 
                        data: data,
                        success: function (response) {
                            alert("成功加入收藏！");
                            $(".collectionbtn > button").removeClass("btn-outline-success").addClass("btn-success").text("已收藏");
                      
                        },
                        error: function () {
                            alert("加入失敗");
                        }
                    });
                } else {
                    
                    var userWantsToLogin = confirm("您需要登入後才能收藏活動，是否要登入?");
                    if (userWantsToLogin) {    
                        window.location.href = 'http://localhost:8081/artion/html/member/memberLogin.html'; // 请将 URL 替换为实际的 URL
                    }
                    
                }
            });
        });



//================== 取得localstorage + 加入購物車(完成 memId/actId/json版本) ==================
        // 測試存一個memId到localstorage
//         localStorage.clear();
//         localStorage.setItem('memId', '7001');

        //判斷有無localstorage資料並且發送actid給後端進行redis儲存
//        $(document).ready(function () {
//     $("#addtocart").click(function () {
//         var urlParams = new URLSearchParams(window.location.search);
//         var actId = urlParams.get("actId");
//         var memId = localStorage.getItem("memId");

//         var dataToSend = {
//             actId: actId,
//             memId: memId
//         };

//         $.ajax({
//             type: "POST",
//             url: "http://localhost:8081/artion/addToCartServlet",
//             data: JSON.stringify(dataToSend),
//             contentType: "application/json",
//             dataType: "json",
//             success: function (response) {
//                 console.log("成功加入購物車");
//             },
//             error: function () {
//                 console.error("加入購物車失敗");
//             }
//         });
//     });
// });

        
//================== 取得localstorage + 加入購物車(測試 memId/actId版本) ==================
$("#addtocart").click(function () {
    // 获取actId和memId
    var actId = getUrlParameter("actId"); // 从URL中获取actId
    var memId = localStorage.getItem("memId"); // 从LocalStorage中获取memId

    // 检查是否成功获取actId和memId
    if (actId && memId) {
        // 创建要发送的数据对象
        var data = {
            actId: actId,
            memId: memId
        };

        // 发送actId和memId到服务器
        $.ajax({
            type: "POST", // 使用POST请求
            url: "http://localhost:8081/artion/AddToCart2", // 你的Servlet的URL，根据你的设置可能需要修改
            data: data, // 发送的数据对象
            dataType: "json",
            success: function (response) {
                // 处理成功响应
                console.log(response.message);
            },
            error: function () {
                // 处理错误响应
                console.error("添加到购物车时出错！");
            }
        });
    } else {
        console.error("无法获取actId或memId。");
    }


    function getUrlParameter(name) {
        name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regex = new RegExp("[\\?&]" + name + "=([^&#]*)");
        var results = regex.exec(location.search);
        return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
    }
});








        //================== 立即購票(未完成) ==================
        $(document).ready(function () {
            $("#buyTicket").click(function () {
                if (!localStorage.getItem("memId")) {
                    var confirmLogin = confirm("請先登入以繼續購票。是否前往登入頁？");
                    if (confirmLogin) {
                        window.location.href = "http://localhost:8081/artion/html/member/memberLogin.html";
                    }
                } else {
                    
                    // window.location.href = "訂單頁面url";
                }
            });
        });


        //================== 新增活動留言功能(完成) ==================
        let button = document.getElementById("commentForm");
        let actId = document.getElementById("actId");
        button.addEventListener('click', function(e) { 
//         	e.preventDefault();
        	const queryString = window.location.search;
        	const urlParams = new URLSearchParams(queryString);
        	const id = urlParams.get('actId');
        	actId.value = id;
        });
        //新增活動留言功能(測試)
        document.getElementById("commentForm").addEventListener("submit", function (e) {
        	  e.preventDefault();
        	  const formData = new FormData(this);

        	  fetch("http://localhost:8081/artion/addActComServlet", {
        	    method: "POST",
        	    body: formData
        	  })
        	    .then(response => { console.log(response);
        	    return response;}
        	    )
//         	    response.json())
        	    .then(data => {
        console.log(data);
        	      // 成功載入頁面
        	      if (data.success) {
        	    	  document.getElementById("actComContent").value = "";
        	    	  document.getElementById("actComCovPicture").value = "";
        	    	  document.getElementById("actComPicture1").value = "";
        	    	  document.getElementById("actComPicture2").value = "";
        	    	  document.getElementById("actComPicture3").value = "";
        	          window.location.reload();
        	      } else {
        	        console.error("提交失败:", data.error);
        	      }
        	      window.history.go();
        	    })
        	    .catch(error => {
        	      console.error("Error:", error);
        	    });
        	});


        //================== 留言上傳檔案樣式轉換(完成) ==================
        const file1 = document.getElementById("actComCovPicture");
        const file1Btn = document.getElementById("picture1");
        const file1Text = document.getElementById("pictureText1");
        file1Btn.addEventListener("click", function () {
            file1.click();
        });
        file1.addEventListener("change", function () {
            if (file1.value) {
                file1Text.innerHTML = file1.value;
            } else {
                file1Text.innerHTML = "未選取圖片";
            }
        });

        const file2 = document.getElementById("actComPicture1");
        const file2Btn = document.getElementById("picture2");
        const file2Text = document.getElementById("pictureText2");
        file2Btn.addEventListener("click", function () {
            file2.click();
        });
        file2.addEventListener("change", function () {
            if (file2.value) {
                file2Text.innerHTML = file2.value;
            } else {
                file2Text.innerHTML = "未選取圖片";
            }
        });

        const file3 = document.getElementById("actComPicture2");
        const file3Btn = document.getElementById("picture3");
        const file3Text = document.getElementById("pictureText3");
        file3Btn.addEventListener("click", function () {
            file3.click();
        });
        file3.addEventListener("change", function () {
            if (file3.value) {
                file3Text.innerHTML = file3.value;
            } else {
                file3Text.innerHTML = "未選取圖片";
            }
        });

        const file4 = document.getElementById("actComPicture3");
        const file4Btn = document.getElementById("picture4");
        const file4Text = document.getElementById("pictureText4");
        file4Btn.addEventListener("click", function () {
            file4.click();
        });
        file4.addEventListener("change", function () {
            if (file4.value) {
                file4Text.innerHTML = file4.value;
            } else {
                file4Text.innerHTML = "未選取圖片";
            }
        });

        $(document).ready(function () {
            $("#clearFiles").click(function () {
                $("#actComCovPicture").val('');
                $("#actComPicture1").val('');
                $("#actComPicture2").val('');
                $("#actComPicture3").val('');
                file1Text.innerHTML = "未選取圖片";
                file2Text.innerHTML = "未選取圖片";
                file3Text.innerHTML = "未選取圖片";
                file4Text.innerHTML = "未選取圖片";
            });
        });

            //================== 獲取活動頁資料並渲染在畫面上(完成) ==================
//             $(document).ready(function () {
//                 var urlParams = new URLSearchParams(window.location.search);
//                 var actId = urlParams.get("actId");
//                 var actTypeMap = {
//                     1: '展覽',
//                     2: '市集',
//                     3: '表演'
//                 };
//                 if (actId) {
//                     $.ajax({
//                         type: "POST",
//                         url: "http://localhost:8081/artion/getAllAct",
//                         dataType: "JSON",
//                         success: function (data) {
//                             var actData = data.find(function (act) {
//                                 return act.actId == actId;
//                             });

//                             if (actData) {
//                                 var actTypeText = actTypeMap[actData.actType] || '未知類型';

//                                 $("#actType").text(actTypeText);
//                                 $("#actName").text(actData.actName);
//                                 $("#iconCount").text(actData.ActLikeTimes);
//                                 $("#actTime").text(actData.actStartDate + " ~ " + actData.actEndDate + " , " + actData.ActStartTime + " ~ " + actData.ActEndTime);
//                                 $("#actAdd").text(actData.ActAdd);
//                                 $("#actTicPrice").text(actData.actTicPrice);
//                                 $("#actContent").text(actData.ActContent);
//                                 // 利用actId取得該筆資的圖片
//                                 var imgSrc = "http://localhost:8081/artion/actPicServlet?actId=" + actId;
//                                 $("#actCovPic").attr("src", imgSrc);
//                             } else {
//                                 $("#actData").html("找不到該活動的數據");
//                             }
//                         },
//                         error: function () {
//                             alert("無法活動獲取數據");
//                         }
//                     });
//                 } else {
//                     $("#actData").html("未提供活動ID");
//                 }
//             });


            //================== 載入頁面時取得活動留言(完成) ================== 
            $(document).ready(function () {
                var urlParams = new URLSearchParams(window.location.search);
                var actIdFromURL = urlParams.get("actId");

                $.ajax({
                    type: "GET",
                    url: "http://localhost:8081/artion/getActComServlet",
                    dataType: "json",
                    success: function (data) {
                        if (data) {
                            $("#imagePreviewsForMessage").empty();
                            data.reverse();
                            $.each(data, function (index, actCom) {
                                if (actIdFromURL == actCom.actId) {
                                    var commentHtml = `
                                            <span style="display: flex; border: 0px red solid; margin:5px 10px">
                                                <div style="border:0px black solid; padding:10px">
                                                    <img src="" class="card-img top" alt="">查無圖片
                                                </div>
                                                <div style="border: 0px red solid; width: 550px;">
                                                    <span style="font-weight: bold">${actCom.memNickName}</span>
                                                    <br>
                                                    <div>${actCom.actComContent}</div>
                                                    <img src="http://localhost:8081/artion/actComPicServlet?actComId=${actCom.actComId}&picNumber=cover" alt="" style="width:120px;">
                                                    <img src="http://localhost:8081/artion/actComPicServlet?actComId=${actCom.actComId}&picNumber=1" alt="" style="width:120px;">
                                                    <img src="http://localhost:8081/artion/actComPicServlet?actComId=${actCom.actComId}&picNumber=2" alt="" style="width:120px;">
                                                    <img src="http://localhost:8081/artion/actComPicServlet?actComId=${actCom.actComId}&picNumber=3" alt="" style="width:120px;">
                                                    <br>
                                                    <span style="border: 0px gray solid;font-style: italic;">${actCom.actComTime}</span>
                                                    <button style="border:0px solid purple;background-color:transparent ;" id="commentLike1">
                                                        <svg xmlns="http://www.w3.org/2000/svg" height="1.5em" viewBox="0 0 512 512" style="fill:black">
                                                            <path d="M323.8 34.8c-38.2-10.9-78.1 11.2-89 49.4l-5.7 20c-3.7 13-10.4 25-19.5 35l-51.3 56.4c-8.9 9.8-8.2 25 1.6 33.9s25 8.2 33.9-1.6l51.3-56.4c14.1-15.5 24.4-34 30.1-54.1l5.7-20c3.6-12.7 16.9-20.1 29.7-16.5s20.1 16.9 16.5 29.7l-5.7 20c-5.7 19.9-14.7 38.7-26.6 55.5c-5.2 7.3-5.8 16.9-1.7 24.9s12.3 13 21.3 13L448 224c8.8 0 16 7.2 16 16c0 6.8-4.3 12.7-10.4 15c-7.4 2.8-13 9-14.9 16.7s.1 15.8 5.3 21.7c2.5 2.8 4 6.5 4 10.6c0 7.8-5.6 14.3-13 15.7c-8.2 1.6-15.1 7.3-18 15.1s-1.6 16.7 3.6 23.3c2.1 2.7 3.4 6.1 3.4 9.9c0 6.7-4.2 12.6-10.2 14.9c-11.5 4.5-17.7 16.9-14.4 28.8c.4 1.3 .6 2.8 .6 4.3c0 8.8-7.2 16-16 16H286.5c-12.6 0-25-3.7-35.5-10.7l-61.7-41.1c-11-7.4-25.9-4.4-33.3 6.7s-4.4 25.9 6.7 33.3l61.7 41.1c18.4 12.3 40 18.8 62.1 18.8H384c34.7 0 62.9-27.6 64-62c14.6-11.7 24-29.7 24-50c0-4.5-.5-8.8-1.3-13c15.4-11.7 25.3-30.2 25.3-51c0-6.5-1-12.8-2.8-18.7C504.8 273.7 512 257.7 512 240c0-35.3-28.6-64-64-64l-92.3 0c4.7-10.4 8.7-21.2 11.8-32.2l5.7-20c10.9-38.2-11.2-78.1-49.4-89zM32 192c-17.7 0-32 14.3-32 32V448c0 17.7 14.3 32 32 32H96c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32H32z" />
                                                        </svg>
                                                    </button>
                                                    <button style="border:0px solid purple;background-color:transparent; display: none" id="commentLike2">
                                                        <svg xmlns="http://www.w3.org/2000/svg" height="1.5em" viewBox="0 0 512 512" style="fill:#e36868"><path d="M313.4 32.9c26 5.2 42.9 30.5 37.7 56.5l-2.3 11.4c-5.3 26.7-15.1 52.1-28.8 75.2H464c26.5 0 48 21.5 48 48c0 18.5-10.5 34.6-25.9 42.6C497 275.4 504 288.9 504 304c0 23.4-16.8 42.9-38.9 47.1c4.4 7.3 6.9 15.8 6.9 24.9c0 21.3-13.9 39.4-33.1 45.6c.7 3.3 1.1 6.8 1.1 10.4c0 26.5-21.5 48-48 48H294.5c-19 0-37.5-5.6-53.3-16.1l-38.5-25.7C176 420.4 160 390.4 160 358.3V320 272 247.1c0-29.2 13.3-56.7 36-75l7.4-5.9c26.5-21.2 44.6-51 51.2-84.2l2.3-11.4c5.2-26 30.5-42.9 56.5-37.7zM32 192H96c17.7 0 32 14.3 32 32V448c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32V224c0-17.7 14.3-32 32-32z"/></svg>
                                                    </button>
                                                    <span id="commentLike_counter">${actCom.actComLikeTimes}</span>
                                                </div>
                                                <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                                                    data-bs-target="#exampleModal" style="background-color:white ;border-color: #CCCCCC; color: black; max-height: 40px; font-size: 10px;margin-left: 5px;">
                                                        檢舉留言
                                                </button>
                                            </span>
                                            
                                            <div class="imagePreviewsForMessage"></div>
                                            <hr style="margin-left:10px; margin-right: 10px">
                                            `;
                                    $("#imagePreviewsForMessage").append(commentHtml);
                                }
                            });
                        } else {
                            $("#imagePreviewsForMessage").html("無法取得數據。");
                        }
                    },
                    error: function () {
                        alert("無法取得數據");
                    }
                });
            });
            
          //================== 載入頁面時取得該活動廠商資訊(未完成) ================== 
//             $(document).ready(function () {
//             var urlParams = new URLSearchParams(window.location.search);
//             var actIdFromURL = urlParams.get("actId");
            
//             $.ajax({
//                 type: "GET",
//                 url: "http://localhost:8081/artion/actGetSel?actId=" + actIdFromURL,
//                 dataType: "json",
//                 success: function (sellerData) {
//                     if (sellerData) {
                        
//                         $("#selName").text(sellerData.selName);
//                         $("#selInfo").text(sellerData.selInfo);
//                     } else {
//                         console.log("無法獲取資料");
//                     }
//                 },
//                 error: function () {
//                     console.log("無法獲取資料");
//                 }
//             });
        // });

            // ================== 將活動id傳給後端，傳到redis使用(備份) ================== 
//             function getActIdFromURL() {
//             var urlParams = new URLSearchParams(window.location.search);
//             return urlParams.get('actId');   
//             console.log(getActIdFromURL());
//             }
//         		$(document).ready(function () {
//             		$("#addtocart").click(function () {
//                 		var actId = getActIdFromURL();
//                 		console.log(actId);
//                 	$.ajax({
//                     	type: "POST",
//                     	url: "http://localhost:8081/artion/addToCartServlet",
//                     	data: { actId: actId },
//                     		success: function (response) {
//                         		alert("成功送送到servlet！");
//                     		},
//                     	error: function () {
//                         	alert("傳送失敗");
//                     }
//                 });
//             });
        // });

            // ================== 留言按讚功能(未完成) ==================
            $(document).ready(function () {
                var likeCounter = 0;

                $("#commentLike1").click(function () {
                    $("#commentLike1").hide();
                    $("#commentLike2").show();
                    likeCounter++;
                    $("#commentLike_counter").text(likeCounter);
                });

                $("#commentLike2").click(function () {
                    $("#commentLike2").hide();
                    $("#commentLike1").show();
                    likeCounter--;
                    $("#commentLike_counter").text(likeCounter);
                });
            });

            // ================== 留言輸入框自動調整大小(完成) ==================
            $(function () {
                $("#actComContent").on("input propertychange", function (e) {
                    var target = e.target;
                    var dh = $(target).attr('defaultHeight') || 0;
                    if (!dh) {
                        dh = target.clientHeight;
                        $(target).attr('defaultHeight', dh);
                    }
                    target.style.height = dh + 'px';
                    var clientHeight = target.clientHeight;
                    var scrollHeight = target.scrollHeight;
                    if (clientHeight !== scrollHeight) {
                        target.style.height = scrollHeight + 10 + "px";
                    }

                    // Store the current height in localStorage
                    localStorage.setItem('commentInputHeight', target.style.height);
                });

                // Check if there's a stored height in localStorage
                var storedHeight = localStorage.getItem('commentInputHeight');
                if (storedHeight) {
                    $("#actComContent").css('height', storedHeight);
                }
            });
            // ~~~~~~~~~~~~~~~~~~~~~~~~~~ 元素 ~~~~~~~~~~~~~~~~~~~~~~~~~~
            const textarea = document.getElementById('validationTextarea');
            const submitButton = document.querySelector('.submit_button');
            const commentContainer = document.querySelector('.comment-container');

            // ================== 生成留言卡片(未完成和綁定事件) ==================
            // $("#subMes_button").on("click", function () {
            //     let userMessage = ($("#actComContent").val()).trim();
            //     var currentTime = new Date().toLocaleString();
            //     if (userMessage != "") {
            //         let userMes_html = `
            //         <span style="display: flex; border: 0px red solid; margin:5px 10px">
            //                         <div style="border:0px black solid; padding:10px">
            //                             <svg xmlns="http://www.w3.org/2000/svg" height="2em" viewBox="0 0 448 512">
            //                                 <path
            //                                     d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z" />
            //                             </svg>
            //                         </div>
            //                         <div style="border: 0px red solid; width: 550px;">
            //                             <span style="font-weight: bold">會員名稱</span>
            //                             <br>
            //                             <div>${userMessage}</div>
            //                             <span style="border: 0px gray solid;font-style: italic;">${currentTime}</span>
            //                             <button style="border:0px solid purple;background-color:transparent ;"
            //                                 id="commentLike1">
            //                                 <svg xmlns="http://www.w3.org/2000/svg" height="1.5em" viewBox="0 0 512 512"
            //                                     style="fill:black">
            //                                     <path
            //                                         d="M323.8 34.8c-38.2-10.9-78.1 11.2-89 49.4l-5.7 20c-3.7 13-10.4 25-19.5 35l-51.3 56.4c-8.9 9.8-8.2 25 1.6 33.9s25 8.2 33.9-1.6l51.3-56.4c14.1-15.5 24.4-34 30.1-54.1l5.7-20c3.6-12.7 16.9-20.1 29.7-16.5s20.1 16.9 16.5 29.7l-5.7 20c-5.7 19.9-14.7 38.7-26.6 55.5c-5.2 7.3-5.8 16.9-1.7 24.9s12.3 13 21.3 13L448 224c8.8 0 16 7.2 16 16c0 6.8-4.3 12.7-10.4 15c-7.4 2.8-13 9-14.9 16.7s.1 15.8 5.3 21.7c2.5 2.8 4 6.5 4 10.6c0 7.8-5.6 14.3-13 15.7c-8.2 1.6-15.1 7.3-18 15.1s-1.6 16.7 3.6 23.3c2.1 2.7 3.4 6.1 3.4 9.9c0 6.7-4.2 12.6-10.2 14.9c-11.5 4.5-17.7 16.9-14.4 28.8c.4 1.3 .6 2.8 .6 4.3c0 8.8-7.2 16-16 16H286.5c-12.6 0-25-3.7-35.5-10.7l-61.7-41.1c-11-7.4-25.9-4.4-33.3 6.7s-4.4 25.9 6.7 33.3l61.7 41.1c18.4 12.3 40 18.8 62.1 18.8H384c34.7 0 62.9-27.6 64-62c14.6-11.7 24-29.7 24-50c0-4.5-.5-8.8-1.3-13c15.4-11.7 25.3-30.2 25.3-51c0-6.5-1-12.8-2.8-18.7C504.8 273.7 512 257.7 512 240c0-35.3-28.6-64-64-64l-92.3 0c4.7-10.4 8.7-21.2 11.8-32.2l5.7-20c10.9-38.2-11.2-78.1-49.4-89zM32 192c-17.7 0-32 14.3-32 32V448c0 17.7 14.3 32 32 32H96c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32H32z" />
            //                                 </svg>
            //                             </button>
            //                             <button style="border:0px solid purple;background-color:transparent; display: none"
            //                                 id="commentLike2">
            //                                 <svg xmlns="http://www.w3.org/2000/svg" height="1.5em" viewBox="0 0 512 512" style="fill:#e36868"><path d="M313.4 32.9c26 5.2 42.9 30.5 37.7 56.5l-2.3 11.4c-5.3 26.7-15.1 52.1-28.8 75.2H464c26.5 0 48 21.5 48 48c0 18.5-10.5 34.6-25.9 42.6C497 275.4 504 288.9 504 304c0 23.4-16.8 42.9-38.9 47.1c4.4 7.3 6.9 15.8 6.9 24.9c0 21.3-13.9 39.4-33.1 45.6c.7 3.3 1.1 6.8 1.1 10.4c0 26.5-21.5 48-48 48H294.5c-19 0-37.5-5.6-53.3-16.1l-38.5-25.7C176 420.4 160 390.4 160 358.3V320 272 247.1c0-29.2 13.3-56.7 36-75l7.4-5.9c26.5-21.2 44.6-51 51.2-84.2l2.3-11.4c5.2-26 30.5-42.9 56.5-37.7zM32 192H96c17.7 0 32 14.3 32 32V448c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32V224c0-17.7 14.3-32 32-32z"/></svg>
            //                             </button>
            //                             <span id="commentLike_counter"></span>
            //                         </div>
            //                         <button type="button" class="btn btn-primary" data-bs-toggle="modal"
            //                             data-bs-target="#exampleModal" style="background-color:white ;border-color: #CCCCCC; color: black; max-height: 40px; font-size: 10px;margin-left: 5px;">
            //                             檢舉留言
            //                         </button>
            //                     </span>
            //                     <div class="imagePreviewsForMessage"></div>
            //                     <hr style="margin-left:10px; margin-right: 10px">
            //         `;
            //         $("#imagePreviewsForMessage").prepend(userMes_html);
            //         $("#validationTextarea").val("");
            //     }
            // });

            // $("#validationTextarea").on("keyup", function (e) {
            //     if (e.which == 13) {
            //         $("#subMes_button").click();
            //     }
            // });


        // ================== 新增留言功能並且更新留言板內容 ==================
//             $(document).ready(function () {
//             var urlParams = new URLSearchParams(window.location.search);
//             var actIdFromURL = urlParams.get("actId");

//             var $imagePreviewsForMessage = $("#imagePreviewsForMessage");

//             $("#subMes_button").click(function () {
//                 var actComContent = $("#actComContent").val();
//                 if (actComContent.trim() !== "") {
//                     $.ajax({
//                         type: "POST",
//                         url: "http://localhost:8081/artion/addActComServlet",
//                         data: { actComContent: actComContent },
//                         success: function (response) {
//                             $("#actComContent").val("");
//                             var commentHtml = `
//                             <span style="display: flex; border: 0px red solid; margin:5px 10px">
//                                                 <div style="border:0px black solid; padding:10px">
//                                                     <img src="" class="card-img top" alt="">查無圖片
//                                                 </div>
//                                                 <div style="border: 0px red solid; width: 550px;">
//                                                     <span style="font-weight: bold">${actCom.memNickName}</span>
//                                                     <br>
//                                                     <div>${actCom.actComContent}</div>
//                                                     <img src="http://localhost:8081/artion/actComPicServlet?actComId=${actCom.actComId}&picNumber=cover" alt="" style="width:120px;">
//                                                     <img src="http://localhost:8081/artion/actComPicServlet?actComId=${actCom.actComId}&picNumber=1" alt="" style="width:120px;">
//                                                     <img src="http://localhost:8081/artion/actComPicServlet?actComId=${actCom.actComId}&picNumber=2" alt="" style="width:120px;">
//                                                     <img src="http://localhost:8081/artion/actComPicServlet?actComId=${actCom.actComId}&picNumber=3" alt="" style="width:120px;">
//                                                     <br>
//                                                     <span style="border: 0px gray solid;font-style: italic;">${actCom.actComTime}</span>
//                                                     <button style="border:0px solid purple;background-color:transparent ;" id="commentLike1">
//                                                         <svg xmlns="http://www.w3.org/2000/svg" height="1.5em" viewBox="0 0 512 512" style="fill:black">
//                                                             <path d="M323.8 34.8c-38.2-10.9-78.1 11.2-89 49.4l-5.7 20c-3.7 13-10.4 25-19.5 35l-51.3 56.4c-8.9 9.8-8.2 25 1.6 33.9s25 8.2 33.9-1.6l51.3-56.4c14.1-15.5 24.4-34 30.1-54.1l5.7-20c3.6-12.7 16.9-20.1 29.7-16.5s20.1 16.9 16.5 29.7l-5.7 20c-5.7 19.9-14.7 38.7-26.6 55.5c-5.2 7.3-5.8 16.9-1.7 24.9s12.3 13 21.3 13L448 224c8.8 0 16 7.2 16 16c0 6.8-4.3 12.7-10.4 15c-7.4 2.8-13 9-14.9 16.7s.1 15.8 5.3 21.7c2.5 2.8 4 6.5 4 10.6c0 7.8-5.6 14.3-13 15.7c-8.2 1.6-15.1 7.3-18 15.1s-1.6 16.7 3.6 23.3c2.1 2.7 3.4 6.1 3.4 9.9c0 6.7-4.2 12.6-10.2 14.9c-11.5 4.5-17.7 16.9-14.4 28.8c.4 1.3 .6 2.8 .6 4.3c0 8.8-7.2 16-16 16H286.5c-12.6 0-25-3.7-35.5-10.7l-61.7-41.1c-11-7.4-25.9-4.4-33.3 6.7s-4.4 25.9 6.7 33.3l61.7 41.1c18.4 12.3 40 18.8 62.1 18.8H384c34.7 0 62.9-27.6 64-62c14.6-11.7 24-29.7 24-50c0-4.5-.5-8.8-1.3-13c15.4-11.7 25.3-30.2 25.3-51c0-6.5-1-12.8-2.8-18.7C504.8 273.7 512 257.7 512 240c0-35.3-28.6-64-64-64l-92.3 0c4.7-10.4 8.7-21.2 11.8-32.2l5.7-20c10.9-38.2-11.2-78.1-49.4-89zM32 192c-17.7 0-32 14.3-32 32V448c0 17.7 14.3 32 32 32H96c17.7 0 32-14.3 32-32V224c0-17.7-14.3-32-32-32H32z" />
//                                                         </svg>
//                                                     </button>
//                                                     <button style="border:0px solid purple;background-color:transparent; display: none" id="commentLike2">
//                                                         <svg xmlns="http://www.w3.org/2000/svg" height="1.5em" viewBox="0 0 512 512" style="fill:#e36868"><path d="M313.4 32.9c26 5.2 42.9 30.5 37.7 56.5l-2.3 11.4c-5.3 26.7-15.1 52.1-28.8 75.2H464c26.5 0 48 21.5 48 48c0 18.5-10.5 34.6-25.9 42.6C497 275.4 504 288.9 504 304c0 23.4-16.8 42.9-38.9 47.1c4.4 7.3 6.9 15.8 6.9 24.9c0 21.3-13.9 39.4-33.1 45.6c.7 3.3 1.1 6.8 1.1 10.4c0 26.5-21.5 48-48 48H294.5c-19 0-37.5-5.6-53.3-16.1l-38.5-25.7C176 420.4 160 390.4 160 358.3V320 272 247.1c0-29.2 13.3-56.7 36-75l7.4-5.9c26.5-21.2 44.6-51 51.2-84.2l2.3-11.4c5.2-26 30.5-42.9 56.5-37.7zM32 192H96c17.7 0 32 14.3 32 32V448c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32V224c0-17.7 14.3-32 32-32z"/></svg>
//                                                     </button>
//                                                     <span id="commentLike_counter">${actCom.actComLikeTimes}</span>
//                                                 </div>
//                                                 <button type="button" class="btn btn-primary" data-bs-toggle="modal"
//                                                     data-bs-target="#exampleModal" style="background-color:white ;border-color: #CCCCCC; color: black; max-height: 40px; font-size: 10px;margin-left: 5px;">
//                                                         檢舉留言
//                                                 </button>
//                                             </span>
                                            
//                                             <div class="imagePreviewsForMessage"></div>
//                                             <hr style="margin-left:10px; margin-right: 10px">
//                             `;
//                             $imagePreviewsForMessage.prepend(commentHtml);
//                         },
//                         error: function () {
//                             alert("無法取得資料");
//                         }
//                     });
//                 }
//             });
        // });

        </script>
</body>
</html>