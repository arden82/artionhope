<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>天龍Artion</title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <meta content="" name="keywords" />
  <meta content="" name="description" />

  <!-- Favicon -->
  <link href="img/favicon.ico" rel="icon" />

  <!-- Google Web Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <!-- Icon Font Stylesheet -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- Libraries Stylesheet -->
  <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet" />
  <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

  <!-- Customized Bootstrap Stylesheet -->
  <link href="css/bootstrap.min.css" rel="stylesheet" />

  <!-- Template Stylesheet -->
  <link href="css/style.css" rel="stylesheet" />

  <!-- font-awesome -->
  <script src="https://kit.fontawesome.com/c89374f433.js" crossorigin="anonymous"></script>
</head>

<body>
  <div class="container-xxl position-relative bg-white d-flex p-0">
    <!-- Spinner Start -->
    <div id="spinner"
      class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
      <div class="spinner-border text-primary" style="width: 3rem; height: 3rem" role="status">
        <span class="sr-only">Loading...</span>
      </div>
    </div>
    <!-- Spinner End -->

    <!-- Sidebar Start -->
    <div class="sidebar pe-4 pb-3">
      <nav class="navbar bg-light navbar-light">
        <a href="index.html" class="navbar-brand mx-4 mb-3 artionimg">
          <!-- <h3 class="text-primary"><i class="fa fa-hashtag me-2"></i>DASHMIN</h3> -->
          <img src="./img/artion-logo.png" />
        </a>
        <div class="d-flex align-items-center ms-4 mb-4">
          <div class="position-relative">
            <img class="rounded-circle" src="img/user.jpg" alt="" style="width: 40px; height: 40px" id="adminPhoto1" />
            <div class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1">
            </div>
          </div>
          <div class="ms-3">
            <h6 class="mb-0"><span id="admName"></span> </h6>
            <span>Admin</span>
          </div>
        </div>
        <div class="navbar-nav w-100">
          <!-- <a href="index.html" class="nav-item nav-link"><i class="fa-solid fa-address-card"></i>會員總覽</a> -->
          <!-- <a href="memberOrderManage.html" class="nav-item nav-link"><i class="fa-solid fa-table-list"></i> 會員訂單管理</a> -->
          <!-- <a href="firm.html" class="nav-item nav-link"><i class="fa-solid fa-building-user"></i> 廠商總覽</a> -->
          <a href="activityManage.html" class="nav-item nav-link "><i class="fa-solid fa-calendar-check"></i>廠商活動管理</a>

          <a href="../adminchat/adminchat.html" class="nav-item nav-link"><i class="fa-solid fa-comments"></i> 即時客服</a>
          <a href="product.html" class="nav-item nav-link active"><i class="fa-solid fa-box"></i> 周邊商品</a>
          <a href="codeSetting.html" class="nav-item nav-link"><i class="fa-solid fa-barcode"></i> 優惠碼設定</a>
          <a href="manager.html" class="nav-item nav-link"><i class="fa-solid fa-user-tie"></i> 管理者管理</a>
          <!-- <a href="notification.html" class="nav-item nav-link"><i class="fa-solid fa-envelope"></i> 通知信</a> -->
        </div>
      </nav>
    </div>
    <!-- Sidebar End -->

    <!-- Content Start -->
    <div class="content">
      <!-- Navbar Start -->
      <nav class="navbar navbar-expand bg-light navbar-light sticky-top px-4 py-0">
        <a href="index.html" class="navbar-brand d-flex d-lg-none me-4">
          <h2 class="text-primary mb-0"><i class="fa fa-hashtag"></i></h2>
        </a>
        <a href="#" class="sidebar-toggler flex-shrink-0">
          <i class="fa fa-bars"></i>
        </a>
        <!-- <form class="d-none d-md-flex ms-4">
          <input class="form-control border-0" type="search" placeholder="Search" />
        </form> -->
        <div class="navbar-nav align-items-center ms-auto">


          <div class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
              <img class="rounded-circle me-lg-2" src="img/user.jpg" alt="" style="width: 40px; height: 40px"
                id="adminPhoto2" />
              <span id="admName2"></span>
            </a>
            <div class="dropdown-menu dropdown-menu-end bg-light border-0 rounded-0 rounded-bottom m-0">

              <a href="signin.html" class="dropdown-item" id="logOut">Log Out</a>
            </div>
          </div>
        </div>
      </nav>
      <!-- Navbar End -->

      <div class="col-12">
        <div class="bg-light rounded h-100 p-4">
          <h6 class="col-md-3 mb-3" style="font-size: 24px"><a href="">修改商品</a></h6>

          <form method="post" enctype="multipart/form-data">
            <div class="row">
              <div class="col-md-3 mb-3"><label for="merchId" class="form-label">商品編號:</label><span id="merchId"></span>
              </div>
              <div class="d-flex align-items-center ms-4 mb-4">
                <!-- 第一个正方形容器 -->
                <div class="position-relative square-container">
                  <input type="file" id="merchPicture1" accept="image/*" style="display: none" />
                  <div id="userImageContainer1" class="square-image">商品圖1</div>
                </div>
                <!-- 第二个正方形容器 -->
                <div class="position-relative ms-4 square-container">
                  <input type="file" id="merchPicture2" accept="image/*" style="display: none" />
                  <div id="userImageContainer2" class="square-image">商品圖2</div>
                </div>
                <!-- 第三个正方形容器 -->
                <div class="position-relative ms-4 square-container">
                  <input type="file" id="merchPicture3" accept="image/*" style="display: none" />
                  <div id="userImageContainer3" class="square-image">商品圖3</div>
                </div>
                <!-- 第四个正方形容器 -->
                <div class="position-relative ms-4 square-container">
                  <input type="file" id="merchPicture4" accept="image/*" style="display: none" />
                  <div id="userImageContainer4" class="square-image">商品圖4</div>
                </div>
              </div>
            </div>
            <div class="row g-4">
              <div class="bg-light rounded h-100 p-4">
                <div class="col-md-3 mb-3">
                  <label for="merchName" class="form-label">商品名稱</label>
                  <input type="text" class="form-control" id="merchName" />
                </div>
                <div class="row">
                  <div class="col-md-3 mb-3">
                    <label for="merchTotal" class="form-label">商品總數</label>
                    <input type="number" class="form-control" id="merchTotal" />
                  </div>
                  <div class="col-md-3 mb-3">
                    <label for="merchPrice" class="form-label">商品單價</label>
                    <input type="number" class="form-control" id="merchPrice" />
                  </div>
                  <div class="col-md-3 mb-3">
                    <label for="merchSort" class="form-label">商品類別</label>
                    <select class="form-select" id="merchSort" aria-label="Floating label select example">
                      <option selected>請選擇類別</option>
                      <option value="1">服飾</option>
                      <option value="2">配件</option>
                      <option value="3">其他</option>
                    </select>
                  </div>
                </div>

                <div class="row">
                  <div class="col-md-3 mb-3">
                    <label for="merchStartTime" class="form-label">上架時間</label>
                    <input type="datetime-local" class="form-control" id="merchStartTime"
                      aria-describedby="emailHelp" />
                  </div>
                  <div class="col-md-3 mb-3">
                    <label for="merchEndTime" class="form-label">下架時間</label>
                    <input type="datetime-local" class="form-control" id="merchEndTime" />
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-3 mb-3">
                    <label for="merchSellAmount" class="form-label">銷售數量</label>
                    <input type="number" class="form-control" id="merchSellAmount" />
                  </div>
                  <div class="col-md-3 mb-3">
                    <label for="merchStatus" class="form-label">上下架狀態:</label>
                    <select class="form-select" id="merchStatus" aria-label="Floating label select example">
                      <option selected>請選擇狀態</option>
                      <option value="1">下架</option>
                      <option value="2">上架</option>
                    </select>
                  </div>
                </div>
                <div class="col-md-3 mb-3">
                  <label for="merchIntroduction" class="form-label">商品描述</label>
                  <textarea class="form-control" id="merchIntroduction"
                    style="width: 600px; max-width: 910px; min-height: 200px; box-sizing: border-box"></textarea>
                </div>
                <button type="button" class="btn btn-secondary m-2" id="cancel">取消</button>
                <button type="submit" class="btn btn-primary" id="update">修改</button>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Footer Start -->
      <div class="container-fluid pt-4 px-4">
        <div class="bg-light rounded-top p-4">
          <div class="row">
            <div class="col-12 col-sm-6 text-center text-sm-start">&copy; <a href="#">天龍Artion</a>, All Right Reserved.
            </div>
            <div class="col-12 col-sm-6 text-center text-sm-end">
              <!--/*** This template is free as long as you keep the footer author’s credit link/attribution link/backlink. If you'd like to use the template without the footer author’s credit link/attribution link/backlink, you can purchase the Credit Removal License from "https://htmlcodex.com/credit-removal". Thank you for your support. ***/-->
              Designed By <a href="https://htmlcodex.com">HTML Codex</a>

              Distributed By <a class="border-bottom" href="https://themewagon.com" target="_blank">ThemeWagon</a>
            </div>
          </div>
        </div>
      </div>
      <!-- Footer End -->
    </div>
    <!-- Content End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>
  </div>

  <!-- JavaScript Libraries -->
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="lib/chart/chart.min.js"></script>
  <script src="lib/easing/easing.min.js"></script>
  <script src="lib/waypoints/waypoints.min.js"></script>
  <script src="lib/owlcarousel/owl.carousel.min.js"></script>
  <script src="lib/tempusdominus/js/moment.min.js"></script>
  <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
  <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

  <!-- Template Javascript -->
  <script src="js/main.js"></script>
  <script>
    // 获取上传照片的 input 元素和用于显示用户照片的容器元素
    const uploadInputs = [document.getElementById("merchPicture1"), document.getElementById("merchPicture2"), document.getElementById("merchPicture3"), document.getElementById("merchPicture4")];
    const userImageContainers = [document.getElementById("userImageContainer1"), document.getElementById("userImageContainer2"), document.getElementById("userImageContainer3"), document.getElementById("userImageContainer4")];

    // 针对每个上传照片的 input 元素，分别添加事件处理程序
    for (let i = 0; i < uploadInputs.length; i++) {
      const uploadInput = uploadInputs[i];
      const userImageContainer = userImageContainers[i];

      uploadInput.addEventListener("change", function () {
        const file = uploadInput.files[0];
        if (file) {
          const image = document.createElement("img");
          image.src = URL.createObjectURL(file);
          image.classList.add("square-image");

          // 清除容器中的文本和添加新的图像元素
          userImageContainer.textContent = "";
          userImageContainer.appendChild(image);
        }
      });

      userImageContainer.addEventListener("click", function () {
        uploadInput.click();
      });
    }
  </script>
  <script>
    function getMerchData() {
      // 获取查询参数中的管理员 ID
      var urlParams = new URLSearchParams(window.location.search);
      merchId = urlParams.get("merchId");

      console.log(merchId);

      if (merchId) {
        $.ajax({
          url: `${window.location, path}/artion/showOneMerch`,
          type: "POST",
          data: { merchId: merchId },
          dataType: "json",
          success: function (data) {
            console.log(data);

            // showdata(data);

            // 填充表单字段
            $("#merchId").text(data.merchId);
            $("#merchName").val(data.merchName);
            $("#merchTotal").val(data.merchTotal);
            $("#merchPrice").val(data.merchPrice);
            $("#merchSort").val(data.merchSort);
            $("#merchStartTime").val(data.merchStartTime);
            $("#merchEndTime").val(data.merchEndTime);
            $("#merchIntroduction").val(data.merchIntroduction);
            $("#merchSellAmount").val(data.merchSellAmount);
            $("#merchStatus").val(data.merchStatus);

            // 点击“取消”按钮时返回上一页
            $("#cancelButton").on("click", function () {
              history.back();
            });
          },
          error: function () {
            // 处理错误
            alert("请求失败。");
          },
        });
      }
    }

    $(document).ready(function () {
      let path = window.location.pathname;
      path = path.substring(0, path.indexOf("/", 1));
      const admId = localStorage.getItem("admId");
      const admName = localStorage.getItem("admName");
      console.log(admId);
      console.log(admName);

      if (admId != null) {
        const admNameSpan = $("#admName");
        const admNameSpan2 = $("#admName2");

        const adminPhoto1 = $("#adminPhoto1");
        const adminPhoto2 = $("#adminPhoto2");

        console.log(adminPhoto1);

        admNameSpan.text(admName);
        admNameSpan2.text(admName);

        $("#logOut").on("click", function () {
          localStorage.removeItem("admId");
          localStorage.removeItem("admName");

        });


        // const initialImageUrl = "img/user.jpg";
        // http://localhost:8081/artion/adminphoto?admId=1001
        const alternateImageUrl = window.location.origin + path + "/adminphoto?admId=" + admId;

        // let isInitialImage = true;

        adminPhoto1.attr("src", alternateImageUrl);
        adminPhoto2.attr("src", alternateImageUrl);

      } else {
        window.location.href = window.location.origin + path + "signin.html";
      }
      getMerchData();

      $("#update").on("click", function () {
        let merch = new FormData();

        merch.append("merchId", $("#merchId").text());
        merch.append("merchName", $("#merchName").val());
        merch.append("merchTotal", $("#merchTotal").val());
        merch.append("merchPrice", $("#merchPrice").val());
        merch.append("merchSort", $("#merchSort").val());
        merch.append("merchStartTime", $("#merchStartTime").val());
        merch.append("merchEndTime", $("#merchEndTime").val());
        merch.append("merchIntroduction", $("#merchIntroduction").val());
        merch.append("merchSellAmount", $("#merchSellAmount").val());
        merch.append("merchStatus", $("#merchStatus").val());
        merch.append("merchPicture1", $("#merchPicture1")[0].files[0]);
        merch.append("merchPicture2", $("#merchPicture2")[0].files[0]);
        merch.append("merchPicture3", $("#merchPicture3")[0].files[0]);
        merch.append("merchPicture4", $("#merchPicture4")[0].files[0]);

        console.log(merch);

        $.ajax({
          url: `${window.location, path}/artion/updateMerch`, // 替换为用于更新数据的后端URL
          type: "POST", // 根据你的需要选择请求类型
          data: merch, // 发送的数据
          processData: false, // 禁止处理数据
          contentType: false, // 禁止设置内容类型

          success: function () {
            location.href = window.location.origin + path + "product.html?admId=" + admId;
          },
          error: function (error) {
            // 在请求失败时执行的操作
            console.error(error);
            // 可以添加其他处理请求失败后的操作，例如显示错误消息
          },
        });
      });
      $("#cancel").on("click", function () {
        location.href = window.location.origin + path + "product.html?admId=" + admId;
      });
    });
  </script>
</body>

</html>