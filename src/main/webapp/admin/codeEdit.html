<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>天龍Artion</title>
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <meta content="" name="keywords" />
  <meta content="" name="description" />

  <!-- Favicon -->
  <link href="img/favicon.ico" rel="icon" />

  <!-- Google Web Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <!-- Icon Font Stylesheet -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- Libraries Stylesheet -->
  <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet" />
  <link href="lib/tempusdominus/css/tempusdominus-bootstrap-4.min.css" rel="stylesheet" />

  <!-- Customized Bootstrap Stylesheet -->
  <link href="css/bootstrap.min.css" rel="stylesheet" />

  <!-- Template Stylesheet -->
  <link href="css/style.css" rel="stylesheet" />

  <!-- font-awesome -->
  <script src="https://kit.fontawesome.com/c89374f433.js" crossorigin="anonymous"></script>
</head>

<body>
  <div class="container-xxl position-relative bg-white d-flex p-0">
    <!-- Spinner Start -->
    <div id="spinner"
      class="show bg-white position-fixed translate-middle w-100 vh-100 top-50 start-50 d-flex align-items-center justify-content-center">
      <div class="spinner-border text-primary" style="width: 3rem; height: 3rem" role="status">
        <span class="sr-only">Loading...</span>
      </div>
    </div>
    <!-- Spinner End -->

    <!-- Sidebar Start -->
    <div class="sidebar pe-4 pb-3">
      <nav class="navbar bg-light navbar-light">
        <a href="index.html" class="navbar-brand mx-4 mb-3 artionimg">
          <!-- <h3 class="text-primary"><i class="fa fa-hashtag me-2"></i>DASHMIN</h3> -->
          <img src="./img/artion-logo.png" />
        </a>
        <div class="d-flex align-items-center ms-4 mb-4">
          <div class="position-relative">
            <img class="rounded-circle" src="img/user.jpg" alt="" style="width: 40px; height: 40px" id="adminPhoto1" />
            <div class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1">
            </div>
          </div>
          <div class="ms-3">
            <h6 class="mb-0">Jhon Doe</h6>
            <span>Admin</span>
          </div>
        </div>
        <div class="navbar-nav w-100">
          <!-- <a href="index.html" class="nav-item nav-link"><i class="fa-solid fa-address-card"></i>會員總覽</a> -->
          <!-- <a href="memberOrderManage.html" class="nav-item nav-link"><i class="fa-solid fa-table-list"></i> 會員訂單管理</a> -->
          <!-- <a href="firm.html" class="nav-item nav-link"><i class="fa-solid fa-building-user"></i> 廠商總覽</a> -->
          <a href="activityManage.html" class="nav-item nav-link"><i class="fa-solid fa-calendar-check"></i> 廠商活動管理</a>

          <a href="../adminchat/adminchat.html" class="nav-item nav-link"><i class="fa-solid fa-comments"></i> 即時客服</a>
          <a href="product.html" class="nav-item nav-link"><i class="fa-solid fa-box"></i> 周邊商品</a>
          <a href="codeSetting.html" class="nav-item nav-link active"><i class="fa-solid fa-barcode"></i> 優惠碼設定</a>
          <a href="manager.html" class="nav-item nav-link"><i class="fa-solid fa-user-tie"></i> 管理者管理</a>
          <!-- <a href="notification.html" class="nav-item nav-link"><i class="fa-solid fa-envelope"></i> 通知信</a> -->
        </div>
      </nav>
    </div>
    <!-- Sidebar End -->

    <!-- Content Start -->
    <div class="content">
      <!-- Navbar Start -->
      <nav class="navbar navbar-expand bg-light navbar-light sticky-top px-4 py-0">
        <a href="index.html" class="navbar-brand d-flex d-lg-none me-4">
          <h2 class="text-primary mb-0"><i class="fa fa-hashtag"></i></h2>
        </a>
        <a href="#" class="sidebar-toggler flex-shrink-0">
          <i class="fa fa-bars"></i>
        </a>
        <!-- <form class="d-none d-md-flex ms-4">
          <input class="form-control border-0" type="search" placeholder="Search" />
        </form> -->
        <div class="navbar-nav align-items-center ms-auto">


          <div class="nav-item dropdown">
            <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
              <img class="rounded-circle me-lg-2" src="img/user.jpg" alt="" style="width: 40px; height: 40px"
                id="adminPhoto2" />
              <span id="admName2"></span>
            </a>
            <div class="dropdown-menu dropdown-menu-end bg-light border-0 rounded-0 rounded-bottom m-0">

              <a href="signin.html" class="dropdown-item" id="logOut">Log Out</a>
            </div>
          </div>
        </div>
      </nav>
      <!-- Navbar End -->

      <div class="container-fluid pt-4 px-4">
        <div class="row g-4">
          <div class="bg-light rounded h-100 p-4">
            <h6 class="mb-4">優惠碼設定</h6>
            <form>
              <div class="row">
                <div class="col-md-3 mb-3"><label for="promoCodeId" class="form-label">優惠碼流水號:</label><span
                    id="promoCodeId"></span></div>
                <div class="col-md-4 mb-3">
                  <label for="promoCodeName" class="form-label">優惠碼名稱</label>
                  <input type="text" class="form-control" id="promoCodeName" aria-describedby="emailHelp" />
                </div>
                <div class="col-md-4 mb-3">
                  <label for="promoCodeCode" class="form-label">優惠碼代碼</label>
                  <input type="text" class="form-control" id="promoCodeCode" />
                </div>
              </div>

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="proCodeType" class="form-label">折扣種類</label>
                  <select class="form-select" id="proCodeType" aria-label="Floating label select example">
                    <option selected>請選擇折扣</option>
                    <option value="1">%數</option>
                    <option value="2">折抵現金</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="proCodeValue" class="form-label">折扣百分比/金額</label>
                  <input type="number" class="form-control" id="proCodeValue" />
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="proCodeStartDate" class="form-label">起始日期</label>
                  <input type="date" class="form-control" id="proCodeStartDate" />
                </div>
                <div class="col-md-6 mb-3">
                  <label for="proCodeEndDate" class="form-label">截止日期</label>
                  <input type="date" class="form-control" id="proCodeEndDate" />
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="proCodeActType" class="form-label">適用活動類型</label>
                  <select class="form-select" id="proCodeActType" aria-label="Floating label select example">
                    <option selected>全部</option>
                    <option value="1">市集</option>
                    <option value="2">展覽</option>
                    <option value="3">表演</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="memLevLevel" class="form-label">會員等級</label>
                  <select class="form-select" id="memLevLevel" aria-label="Floating label select example">
                    <option selected>請選擇等級</option>
                    <option value="1">一般</option>
                    <option value="2">高級</option>
                    <option value="3">尊榮</option>
                  </select>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="proCodeTotal" class="form-label">數量</label>
                  <input type="number" class="form-control" id="proCodeTotal" />
                </div>
                <div class="col-md-6 mb-3">
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="proCodeStatus" class="form-label">狀態</label>
                      <select class="form-select" id="proCodeStatus" aria-label="Floating label select example">
                        <option selected>請選擇狀態</option>
                        <option value="1">下架</option>
                        <option value="2">上架</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
              <label for="proCodeDescribe" class="form-label">使用說明</label>
              <div class="form-floating">
                <textarea class="form-control" placeholder="Leave a comment here" id="proCodeDescribe"
                  style="height: 200px"></textarea>
                <label for="floatingTextarea">Comments</label>
              </div>
              <button type="button" class="btn btn-secondary m-2" id="cancel">取消</button>
              <button type="button" class="btn btn-primary" id="commit">送出</button>
            </form>
          </div>
        </div>
      </div>

      <!-- Footer Start -->
      <div class="container-fluid pt-4 px-4">
        <div class="bg-light rounded-top p-4">
          <div class="row">
            <div class="col-12 col-sm-6 text-center text-sm-start">&copy; <a href="#">天龍Artion</a>, All Right Reserved.
            </div>
            <div class="col-12 col-sm-6 text-center text-sm-end">
              <!--/*** This template is free as long as you keep the footer author’s credit link/attribution link/backlink. If you'd like to use the template without the footer author’s credit link/attribution link/backlink, you can purchase the Credit Removal License from "https://htmlcodex.com/credit-removal". Thank you for your support. ***/-->
              Designed By <a href="https://htmlcodex.com">HTML Codex</a>

              Distributed By <a class="border-bottom" href="https://themewagon.com" target="_blank">ThemeWagon</a>
            </div>
          </div>
        </div>
      </div>
      <!-- Footer End -->
    </div>
    <!-- Content End -->

    <!-- Back to Top -->
    <a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>
  </div>

  <!-- JavaScript Libraries -->
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="lib/chart/chart.min.js"></script>
  <script src="lib/easing/easing.min.js"></script>
  <script src="lib/waypoints/waypoints.min.js"></script>
  <script src="lib/owlcarousel/owl.carousel.min.js"></script>
  <script src="lib/tempusdominus/js/moment.min.js"></script>
  <script src="lib/tempusdominus/js/moment-timezone.min.js"></script>
  <script src="lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js"></script>

  <!-- Template Javascript -->
  <script src="js/main.js"></script>
  <script>
    let path = window.location.pathname;
    path = path.substring(0, path.indexOf("/", 1));
    const admId = localStorage.getItem("admId");
    const admName = localStorage.getItem("admName");
    console.log(admId);
    console.log(admName);

    if (admId != null) {
      const admNameSpan = $("#admName");
      const admNameSpan2 = $("#admName2");

      const adminPhoto1 = $("#adminPhoto1");
      const adminPhoto2 = $("#adminPhoto2");

      console.log(adminPhoto1);

      admNameSpan.text(admName);
      admNameSpan2.text(admName);

      $("#logOut").on("click", function () {
        localStorage.removeItem("admId");
        localStorage.removeItem("admName");

      });


      // const initialImageUrl = "img/user.jpg";
      // http://localhost:8081/artion/adminphoto?admId=1001
      const alternateImageUrl = window.location.origin + path + "/adminphoto?admId=" + admId;

      // let isInitialImage = true;

      adminPhoto1.attr("src", alternateImageUrl);
      adminPhoto2.attr("src", alternateImageUrl);

    } else {
      window.location.href = "signin.html";
    }
    const queryParams = new URLSearchParams(location.search);
    const promoCodeId = queryParams.get('promoCodeId');
    $('#promoCodeId').text(promoCodeId);



    $.ajax({
      url: `${window.location, path}/showOnePromoCode?promoCodeId=${promoCodeId}`,
      dataType: "json",
      success: function (promo) {
        $('#promoCodeName').val(promo.proCodeName);
        $('#promoCodeCode').val(promo.proCodeCode);
        $('#proCodeType').val(promo.proCodeType);
        $('#proCodeValue').val(promo.proCodeValue);
        $('#proCodeStartDate').val(promo.proCodeStartDate);
        $('#proCodeEndDate').val(promo.proCodeEndDate);
        $('#proCodeActType').val(promo.proCodeActType);
        $('#memLevLevel').val(promo.proCodeStatus);
        $('#proCodeTotal').val(promo.proCodeTotal);
        $('#proCodeStatus').val(promo.proCodeStatus);
        $('#proCodeDescribe').val(promo.proCodeDescribe);

      },
      error: function () {

      },
    });


    //填充表單
    function getPromoCodeData() {
      // 获取查询参数中的商品ID
      var urlParams = new URLSearchParams(window.location.search);
      var promoCodeId = urlParams.get("promoCodeId");

      console.log(promoCodeId);

      if (promoCodeId) {
        $.ajax({
          url: `${window.location, path}/showOnePromoCode`,

          //             url: "http://localhost:8081/artion/showOnePromoCode",
          type: "POST",
          data: { promoCodeId: promoCodeId },
          dataType: "json",
          success: function (data) {
            console.log(data);

            // 填充表单字段
            $("#promoCodeId").text(data.promoCodeId);
            $("#promoCodeName").val(data.promoCodeName);
            $("#promoCodeCode").val(data.promoCodeCode);
            $("#proCodeType").val(data.proCodeType);
            $("#proCodeValue").val(data.proCodeValue);
            $("#proCodeStartDate").val(data.proCodeStartDate);
            $("#proCodeEndDate").val(data.proCodeEndDate);
            $("#proCodeActType").val(data.proCodeActType);
            $("#memLevLevel").val(data.memLevLevel);
            $("#proCodeTotal").val(data.proCodeTotal);
            $("#proCodeStatus").val(data.proCodeStatus);
            $("#proCodeDescribe").val(data.proCodeDescribe);

            // 点击“取消”按钮时返回上一页
            $("#cancel").on("click", function () {
              history.back();
            });
          },
          error: function () {
            // 处理错误
            alert("请求失败。");
          },
        });
      }
    }

    $(document).ready(function () {


      //         getPromoCodeData();

      //更新優惠碼
      $("#commit").on("click", function () {
        // 创建一个对象来保存表单数据
        var promoCodeData = {
          promoCodeId: $("#promoCodeId").text(),
          promoCodeName: $("#promoCodeName").val(),
          promoCodeCode: $("#promoCodeCode").val(),
          proCodeType: $("#proCodeType").val(),
          proCodeValue: $("#proCodeValue").val(),
          proCodeStartDate: $("#proCodeStartDate").val(),
          proCodeEndDate: $("#proCodeEndDate").val(),
          proCodeActType: $("#proCodeActType").val(),
          proCodeTotal: $("#proCodeTotal").val(),
          proCodeStatus: $("#proCodeStatus").val(),
          proCodeDescribe: $("#proCodeDescribe").val(),
          memLevLevel: $("#memLevLevel").val(),
          admId: admId,
        };

        // 发送数据到后端
        $.ajax({
          url: `${window.location, path}/updatePromoCode`,

          //             url: "http://localhost:8081/artion/updatePromoCode", // 替换为用于更新数据的后端URL
          type: "POST", // 根据您的需要选择请求类型
          data: promoCodeData, // 发送的数据
          success: function () {
            // 在成功时执行的操作
            alert("優惠碼已成功更新！");
            // 可以添加其他成功后的操作，例如重定向到其他页面
            location.href = window.location.origin + path + "codeSetting.html?admId=" + admId;
          },
          error: function (error) {
            // 在请求失败时执行的操作
            console.error(error);
            location.href = window.location.origin + path + "codeEdit.html?promoCodeId=" + promoCodeId;
          },
        });
      });

      //取消按鈕
      $("#cancel").on("click", function () {
        location.href = window.location.origin + path + "codeSetting.html?admId=" + admId;
      });
    });
  </script>
</body>

</html>